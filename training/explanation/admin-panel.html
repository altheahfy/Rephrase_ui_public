<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•çš„ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ‘ãƒãƒ« - Rephrase</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* ç®¡ç†ãƒ‘ãƒãƒ«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .admin-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin-header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 2em;
        }

        .admin-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ */
        .control-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .warning-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            color: #856404;
            font-size: 0.95em;
        }

        .control-section h2 {
            color: #1976D2;
            margin: 0 0 20px 0;
            font-size: 1.3em;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .action-button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s;
            min-width: 140px;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #FF9800;
            color: white;
        }

        .btn-warning:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #00BCD4;
            color: white;
        }

        .btn-info:hover {
            background: #0097A7;
            transform: translateY(-2px);
        }

        .output-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }

        .output-container pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            margin-left: 10px;
        }

        .status-ready {
            background: #E8F5E8;
            color: #2E7D2E;
        }

        .status-working {
            background: #FFF3E0;
            color: #E65100;
        }

        .status-error {
            background: #FFEBEE;
            color: #C62828;
        }

        .preview-frame {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin: 20px 0;
        }

        .metadata-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .info-card h3 {
            margin: 0 0 10px 0;
            color: #1976D2;
            font-size: 1.1em;
        }

        .log-entry {
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 4px;
        }

        .log-success {
            background: #E8F5E8;
            color: #2E7D2E;
        }

        .log-error {
            background: #FFEBEE;
            color: #C62828;
        }

        .log-info {
            background: #E3F2FD;
            color: #1565C0;
        }

        .grammar-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 10px;
        }

        .grammar-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .grammar-item:hover {
            background: #f8f9fa;
        }

        .grammar-item:last-child {
            border-bottom: none;
        }

        .grammar-name {
            font-weight: 500;
            color: #333;
        }

        .grammar-key {
            font-size: 0.85em;
            color: #666;
            font-family: monospace;
        }

        /* ã‚¨ãƒ‡ã‚£ã‚¿é–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .editor-section {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .editor-section h3 {
            margin: 0 0 20px 0;
            color: #1976D2;
            font-size: 1.2em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .form-input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
        }

        .content-editor {
            margin-bottom: 15px;
        }

        .content-editor textarea {
            width: 100%;
            min-height: 400px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.95em;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .content-editor textarea:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
        }

        .editor-toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn-small {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-small:hover {
            background: #f0f0f0;
            border-color: #ccc;
        }

        .btn-auto-format {
            background: #4CAF50 !important;
            color: white !important;
            border-color: #4CAF50 !important;
            font-weight: 600;
        }

        .btn-auto-format:hover {
            background: #45a049 !important;
            border-color: #45a049 !important;
            transform: translateY(-1px);
        }

        .btn-delete {
            background: #f44336 !important;
            color: white !important;
            border-color: #f44336 !important;
        }

        .btn-delete:hover {
            background: #d32f2f !important;
            border-color: #d32f2f !important;
            transform: translateY(-1px);
        }

        .preview-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .preview-content h2 {
            color: #2196F3;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .preview-content h3 {
            color: #FF9800;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .preview-content p {
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .preview-content ul, .preview-content ol {
            margin: 15px 0;
            padding-left: 25px;
        }

        .preview-content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="admin-header">
            <h1>ğŸš€ Rephrase å‹•çš„ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ‘ãƒãƒ«</h1>
            <p>æ–‡æ³•èª¬æ˜ãƒšãƒ¼ã‚¸ã®ä¸€æ‹¬ç”Ÿæˆãƒ»ç®¡ç†ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ„ãƒ¼ãƒ«</p>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ -->
        <div class="control-section">
            <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³</h2>
            <p id="systemStatus">ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯ä¸­...<span class="status-indicator status-working">ç¢ºèªä¸­</span></p>
            <div class="metadata-info">
                <div class="info-card">
                    <h3>ğŸ“„ ç™»éŒ²æ¸ˆã¿æ–‡æ³•é …ç›®</h3>
                    <p id="grammarCount">-</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ—‚ï¸ ç”Ÿæˆå¯èƒ½ãƒšãƒ¼ã‚¸</h3>
                    <p id="pageCount">-</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ”— ãƒãƒƒãƒ”ãƒ³ã‚°çŠ¶æ³</h3>
                    <p id="mappingStatus">-</p>
                </div>
                <div class="info-card">
                    <h3>â° æœ€çµ‚æ›´æ–°</h3>
                    <p id="lastUpdate">-</p>
                </div>
            </div>
        </div>

        <!-- ç”Ÿæˆæ“ä½œ -->
        <div class="control-section">
            <h2>âš¡ ç”Ÿæˆæ“ä½œ</h2>
            <p class="warning-note">âš ï¸ <strong>é‹ç”¨æ–¹é‡:</strong> ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ®µéšçš„å…¬é–‹ã®ãŸã‚ã€å®Œæˆã—ãŸãƒšãƒ¼ã‚¸ã®ã¿å€‹åˆ¥ç”Ÿæˆã‚’æ¨å¥¨</p>
            <div class="button-group">
                <button class="action-button btn-primary" onclick="generateSinglePage()" disabled>
                    ğŸ“„ é¸æŠãƒšãƒ¼ã‚¸ç”Ÿæˆ (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰é¸æŠ)
                </button>
                <button class="action-button btn-success" onclick="generateMapping()">
                    ğŸ”— ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆ
                </button>
                <button class="action-button btn-warning" onclick="validateSystem()">
                    âœ… ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼
                </button>
                <button class="action-button btn-info" onclick="runFullTest()">
                    ğŸ§ª å®Œå…¨ãƒ†ã‚¹ãƒˆ
                </button>
            </div>
            <details style="margin-top: 20px;">
                <summary style="cursor: pointer; color: #666; font-size: 0.9em;">âš ï¸ ä¸€æ‹¬ç”Ÿæˆæ©Ÿèƒ½ï¼ˆéæ¨å¥¨ï¼‰</summary>
                <div style="padding: 15px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">
                    <p><strong>æ³¨æ„:</strong> å…¨ãƒšãƒ¼ã‚¸ä¸€æ‹¬ç”Ÿæˆã¯é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨é€”ã®ã¿</p>
                    <button class="action-button btn-warning" onclick="generateAllPages()" style="margin-top: 10px;">
                        âš ï¸ å…¨ãƒšãƒ¼ã‚¸ç”Ÿæˆï¼ˆé–‹ç™ºç”¨ï¼‰
                    </button>
                </div>
            </details></div>
            <div class="output-container">
                <pre id="outputLog">æ“ä½œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
            </div>
        </div>

        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒ‡ã‚£ã‚¿ -->
        <div class="control-section">
            <h2>âœï¸ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒ‡ã‚£ã‚¿</h2>
            <p>ã‚ãªãŸã®æ–‡ç« ã§ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œæˆã§ãã¾ã™ã€‚</p>
            
            <!-- åŸºæœ¬æƒ…å ±å…¥åŠ› -->
            <div class="editor-section">
                <h3>ğŸ“‹ åŸºæœ¬æƒ…å ±</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="grammarDisplayName">è¡¨ç¤ºå *</label>
                        <input type="text" id="grammarDisplayName" placeholder="ä¾‹: è‡ªå‹•è©ç¬¬1æ–‡å‹" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="grammarKey">æ–‡æ³•ã‚­ãƒ¼ *</label>
                        <input type="text" id="grammarKey" placeholder="ä¾‹: è‡ªå‹•è©ç¬¬1æ–‡å‹" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="grammarFilename">ãƒ•ã‚¡ã‚¤ãƒ«å *</label>
                        <input type="text" id="grammarFilename" placeholder="ä¾‹: v-intransitive-type1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="grammarJsonFile">å¯¾å¿œJSONãƒ•ã‚¡ã‚¤ãƒ« *</label>
                        <input type="text" id="grammarJsonFile" placeholder="ä¾‹: Vè‡ªå‹•è©ç¬¬1æ–‡å‹.json" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label for="grammarDescription">èª¬æ˜æ–‡</label>
                    <input type="text" id="grammarDescription" placeholder="ä¾‹: ä¸»èªï¼‹å‹•è©ã®åŸºæœ¬æ–‡å‹ã‚’å­¦ç¿’ã—ã¾ã™" class="form-input">
                </div>
            </div>

            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¥åŠ› -->
            <div class="editor-section">
                <h3>ğŸ“ æœ¬æ–‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</h3>
                <div class="content-editor">
                    <textarea id="contentEditor" placeholder="ã“ã“ã«ã‚ãªãŸã®æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...

ä¾‹:
## è‡ªå‹•è©ç¬¬1æ–‡å‹ã¨ã¯

è‡ªå‹•è©ç¬¬1æ–‡å‹ã¯ã€è‹±èªã®æœ€ã‚‚åŸºæœ¬çš„ãªæ–‡å‹ã§ã™ã€‚

### åŸºæœ¬æ§‹é€ 
ä¸»èªï¼ˆSï¼‰ï¼‹ å‹•è©ï¼ˆVï¼‰

### ä¾‹æ–‡
- I run. (ç§ã¯èµ°ã‚‹)
- She sleeps. (å½¼å¥³ã¯çœ ã‚‹)
- The sun rises. (å¤ªé™½ãŒæ˜‡ã‚‹)

ã“ã®æ–‡å‹ã§ã¯ã€å‹•è©ã¯ç›®çš„èªã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚"></textarea>
                </div>
                <div class="editor-toolbar">
                    <button class="btn-small btn-auto-format" onclick="autoFormatContent()" title="ç”Ÿã®æ–‡ç« ã‚’è‡ªå‹•çš„ã«æ•´å½¢ã—ã¾ã™">ğŸ“ è‡ªå‹•æ•´å½¢</button>
                    <button class="btn-small" onclick="insertMarkdown('## ', '')" title="è¦‹å‡ºã—2">H2</button>
                    <button class="btn-small" onclick="insertMarkdown('### ', '')" title="è¦‹å‡ºã—3">H3</button>
                    <button class="btn-small" onclick="insertMarkdown('**', '**')" title="å¤ªå­—">B</button>
                    <button class="btn-small" onclick="insertMarkdown('*', '*')" title="æ–œä½“">I</button>
                    <button class="btn-small" onclick="insertMarkdown('- ', '')" title="ãƒªã‚¹ãƒˆ">â€¢</button>
                    <button class="btn-small" onclick="insertExample()" title="ä¾‹æ–‡ãƒœãƒƒã‚¯ã‚¹">ä¾‹</button>
                    <button class="btn-small" onclick="insertKeyPoint()" title="é‡è¦ãƒã‚¤ãƒ³ãƒˆ">â­</button>
                </div>
            </div>

            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ç”Ÿæˆãƒœã‚¿ãƒ³ -->
            <div class="button-group">
                <button class="action-button btn-info" onclick="livePreview()">
                    ğŸ‘€ ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                </button>
                <button class="action-button btn-primary" onclick="generateFromEditor()">
                    âœ¨ ãƒšãƒ¼ã‚¸ç”Ÿæˆ
                </button>
                <button class="action-button btn-success" onclick="saveToMetadata()">
                    ğŸ’¾ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                </button>
                <button class="action-button btn-warning" onclick="clearEditor()">
                    ğŸ—‘ï¸ ã‚¨ãƒ‡ã‚£ã‚¿ã‚¯ãƒªã‚¢
                </button>
            </div>

            <!-- ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div id="livePreviewContainer" style="display: none;">
                <h4>ğŸ“– ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                <div id="livePreviewContent" class="preview-content"></div>
            </div>
        </div>

        <!-- æ—¢å­˜é …ç›®ç®¡ç† -->
        <div class="control-section">
            <h2>ğŸ“š æ—¢å­˜é …ç›®ç®¡ç†</h2>
            <p>ä¿å­˜æ¸ˆã¿ã®æ–‡æ³•é …ç›®ã‚’ç·¨é›†ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ç”Ÿæˆã§ãã¾ã™ã€‚</p>
            <div class="grammar-list" id="grammarList">
                <p>æ–‡æ³•é …ç›®ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
            <div class="button-group">
                <button class="action-button btn-info" onclick="refreshGrammarList()">
                    ğŸ”„ ãƒªã‚¹ãƒˆæ›´æ–°
                </button>
                <button class="action-button btn-primary" id="generateSelectedBtn" onclick="generateSelectedPage()" disabled>
                    âœ¨ é¸æŠãƒšãƒ¼ã‚¸ç”Ÿæˆ
                </button>
                <button class="action-button btn-warning" onclick="closePreview()">
                    âŒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‰ã˜ã‚‹
                </button>
            </div>
            <div id="selectedPageInfo" style="display: none; background: #e8f5e8; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <p><strong>é¸æŠä¸­:</strong> <span id="selectedPageName">-</span></p>
            </div>
            <iframe class="preview-frame" id="previewFrame" style="display: none;"></iframe>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± -->
        <div class="control-section">
            <h2>â„¹ï¸ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h2>
            <div class="metadata-info">
                <div class="info-card">
                    <h3>ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«</h3>
                    <p><code>template.html</code></p>
                    <p>çµ±ä¸€ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“Š ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«</h3>
                    <p><code>grammar-metadata.json</code></p>
                    <p>æ–‡æ³•é …ç›®å®šç¾©ãƒ‡ãƒ¼ã‚¿</p>
                </div>
                <div class="info-card">
                    <h3>âš™ï¸ ç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³</h3>
                    <p><code>generator.js</code></p>
                    <p>å‹•çš„ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ æœ¬ä½“</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ”§ ç®¡ç†ãƒ‘ãƒãƒ«</h3>
                    <p><code>admin-panel.html</code></p>
                    <p>ã“ã®ãƒšãƒ¼ã‚¸</p>
                </div>
            </div>
        </div>
    </div>

    <script src="./generator.js"></script>
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let generator = null;
        let tester = null;
        let currentMetadata = null;
        let selectedGrammarKey = null;
        let editorData = null;

        // Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‡¦ç†ã‚¯ãƒ©ã‚¹
        class MarkdownProcessor {
            static process(content) {
                let html = content;
                
                // è¦‹å‡ºã—å‡¦ç†
                html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
                html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
                
                // å¤ªå­—ãƒ»æ–œä½“
                html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
                
                // ãƒªã‚¹ãƒˆå‡¦ç†
                html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
                html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
                
                // æ®µè½å‡¦ç†
                html = html.replace(/\n\n/g, '</p><p>');
                html = '<p>' + html + '</p>';
                
                // ç©ºã®æ®µè½é™¤å»
                html = html.replace(/<p><\/p>/g, '');
                html = html.replace(/<p>\s*<h/g, '<h');
                html = html.replace(/h>\s*<\/p>/g, 'h>');
                html = html.replace(/<p>\s*<ul>/g, '<ul>');
                html = html.replace(/<\/ul>\s*<\/p>/g, '</ul>');
                
                return html;
            }

            static addSpecialBoxes(content) {
                // ä¾‹æ–‡ãƒœãƒƒã‚¯ã‚¹ [[ä¾‹æ–‡: ]] è¨˜æ³•
                content = content.replace(/\[\[ä¾‹æ–‡: (.+?)\]\]/g, 
                    '<div class="example-box"><h4>ä¾‹æ–‡</h4><div class="example-sentence">$1</div></div>');
                
                // é‡è¦ãƒã‚¤ãƒ³ãƒˆ [[é‡è¦: ]] è¨˜æ³•
                content = content.replace(/\[\[é‡è¦: (.+?)\]\]/g, 
                    '<div class="key-point"><h4>é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4><p>$1</p></div>');
                
                // æ³¨æ„ [[æ³¨æ„: ]] è¨˜æ³•
                content = content.replace(/\[\[æ³¨æ„: (.+?)\]\]/g, 
                    '<div class="warning-box"><h4>æ³¨æ„</h4><p>$1</p></div>');
                
                return content;
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        async function initializeSystem() {
            try {
                generator = new GrammarPageGenerator();
                tester = new GrammarSystemTester();
                
                logMessage('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†', 'success');
                updateSystemStatus('ready');
                await loadSystemInfo();
                await refreshGrammarList();
                
            } catch (error) {
                logMessage(`ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³æ›´æ–°
        function updateSystemStatus(status) {
            const statusElement = document.getElementById('systemStatus');
            const now = new Date().toLocaleString('ja-JP');
            
            switch (status) {
                case 'ready':
                    statusElement.innerHTML = `ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº† <span class="status-indicator status-ready">ç¨¼åƒä¸­</span>`;
                    break;
                case 'working':
                    statusElement.innerHTML = `å‡¦ç†å®Ÿè¡Œä¸­... <span class="status-indicator status-working">å®Ÿè¡Œä¸­</span>`;
                    break;
                case 'error':
                    statusElement.innerHTML = `ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ <span class="status-indicator status-error">ã‚¨ãƒ©ãƒ¼</span>`;
                    break;
            }
            
            document.getElementById('lastUpdate').textContent = now;
        }

        // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±èª­ã¿è¾¼ã¿
        async function loadSystemInfo() {
            try {
                currentMetadata = await generator.loadMetadata();
                if (currentMetadata) {
                    const grammarCount = Object.keys(currentMetadata).length;
                    document.getElementById('grammarCount').textContent = `${grammarCount} é …ç›®`;
                    document.getElementById('pageCount').textContent = `${grammarCount} ãƒšãƒ¼ã‚¸`;
                    document.getElementById('mappingStatus').textContent = 'æ­£å¸¸';
                } else {
                    document.getElementById('grammarCount').textContent = 'èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';
                    document.getElementById('pageCount').textContent = 'èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';
                    document.getElementById('mappingStatus').textContent = 'ã‚¨ãƒ©ãƒ¼';
                }
            } catch (error) {
                logMessage(`ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function logMessage(message, type = 'info') {
            const outputLog = document.getElementById('outputLog');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = `[${timestamp}] ${message}`;
            
            // æ—¢å­˜ã®ãƒ­ã‚°ã«è¿½åŠ 
            const currentLog = outputLog.textContent;
            if (currentLog === 'æ“ä½œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...') {
                outputLog.textContent = logEntry;
            } else {
                outputLog.textContent = currentLog + '\n' + logEntry;
            }
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
            outputLog.parentElement.scrollTop = outputLog.parentElement.scrollHeight;
        }

        // å…¨ãƒšãƒ¼ã‚¸ç”Ÿæˆ
        async function generateAllPages() {
            updateSystemStatus('working');
            logMessage('å…¨ãƒšãƒ¼ã‚¸ç”Ÿæˆé–‹å§‹...', 'info');
            
            try {
                const results = await generator.generateAllPages();
                
                let successCount = 0;
                let errorCount = 0;
                
                results.forEach(result => {
                    if (result.success) {
                        successCount++;
                        logMessage(`âœ… ${result.displayName} ç”Ÿæˆå®Œäº†`, 'success');
                    } else {
                        errorCount++;
                        logMessage(`âŒ ${result.displayName} ç”Ÿæˆå¤±æ•—: ${result.error}`, 'error');
                    }
                });
                
                logMessage(`ç”Ÿæˆå®Œäº†: æˆåŠŸ ${successCount}ä»¶, å¤±æ•— ${errorCount}ä»¶`, 'info');
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`å…¨ãƒšãƒ¼ã‚¸ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆ
        async function generateMapping() {
            updateSystemStatus('working');
            logMessage('ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆé–‹å§‹...', 'info');
            
            try {
                const mapping = await generator.generateGrammarMapping();
                const links = await generator.generateMatrixLinks();
                
                if (mapping && links) {
                    logMessage(`âœ… ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆå®Œäº†: ${Object.keys(mapping).length} é …ç›®`, 'success');
                    logMessage(`âœ… ãƒãƒˆãƒªã‚¯ã‚¹ãƒªãƒ³ã‚¯ç”Ÿæˆå®Œäº†: ${links.length} ãƒªãƒ³ã‚¯`, 'success');
                    
                    // ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
                    logMessage('--- ç”Ÿæˆã•ã‚ŒãŸãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ± ---', 'info');
                    Object.entries(mapping).forEach(([key, value]) => {
                        logMessage(`  ${key} â†’ ${value}`, 'info');
                    });
                    
                    // ãƒªãƒ³ã‚¯æƒ…å ±ã®è©³ç´°ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
                    logMessage('--- ç”Ÿæˆã•ã‚ŒãŸãƒãƒˆãƒªã‚¯ã‚¹ãƒªãƒ³ã‚¯è©³ç´° ---', 'info');
                    links.forEach((link, index) => {
                        logMessage(`  ${index + 1}. è¡¨ç¤ºå: ${link.displayName}`, 'info');
                        logMessage(`     ãƒ•ã‚¡ã‚¤ãƒ«: ${link.href}`, 'info');
                        logMessage(`     ãƒãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º: ${link.display}`, 'info');
                        logMessage(`     ã‚«ãƒ†ã‚´ãƒª: ${link.category}`, 'info');
                        logMessage(`     å„ªå…ˆåº¦: ${link.priority}`, 'info');
                        logMessage('', 'info'); // ç©ºè¡Œ
                    });
                    
                    // HTMLãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ã‚‚ç”Ÿæˆã—ã¦è¡¨ç¤º
                    logMessage('--- ãƒãƒˆãƒªã‚¯ã‚¹ç”¨HTMLãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ ---', 'info');
                    links.forEach((link) => {
                        const htmlCode = `<a href="${link.href}" style="color: #2196F3; text-decoration: underline;">${link.display}</a>`;
                        logMessage(`  ${htmlCode}`, 'info');
                    });
                    
                } else {
                    logMessage('âŒ ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
                
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼
        async function validateSystem() {
            updateSystemStatus('working');
            logMessage('ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼é–‹å§‹...', 'info');
            
            try {
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¤œè¨¼
                const template = await generator.loadTemplate();
                if (template) {
                    logMessage('âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: æ­£å¸¸', 'success');
                } else {
                    logMessage('âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: èª­ã¿è¾¼ã¿å¤±æ•—', 'error');
                }
                
                // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
                const metadata = await generator.loadMetadata();
                if (metadata) {
                    logMessage(`âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: æ­£å¸¸ (${Object.keys(metadata).length} é …ç›®)`, 'success');
                    
                    // å„é …ç›®ã®æ¤œè¨¼
                    Object.entries(metadata).forEach(([key, data]) => {
                        if (data.displayName && data.grammarKey && data.filename) {
                            logMessage(`  âœ… ${data.displayName}: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®Œå‚™`, 'success');
                        } else {
                            logMessage(`  âŒ ${data.displayName || key}: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸è¶³`, 'error');
                        }
                    });
                } else {
                    logMessage('âŒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: èª­ã¿è¾¼ã¿å¤±æ•—', 'error');
                }
                
                logMessage('ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼å®Œäº†', 'info');
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // å®Œå…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runFullTest() {
            updateSystemStatus('working');
            logMessage('å®Œå…¨ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
            
            try {
                const results = await tester.runTests();
                
                logMessage('--- ãƒ†ã‚¹ãƒˆçµæœ ---', 'info');
                logMessage(`ç”Ÿæˆã•ã‚ŒãŸãƒšãƒ¼ã‚¸æ•°: ${results.pages.length}`, 'info');
                logMessage(`ãƒãƒƒãƒ”ãƒ³ã‚°é …ç›®æ•°: ${Object.keys(results.mapping).length}`, 'info');
                logMessage(`ãƒãƒˆãƒªã‚¯ã‚¹ãƒªãƒ³ã‚¯æ•°: ${results.links.length}`, 'info');
                
                logMessage('âœ… å®Œå…¨ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // æ–‡æ³•é …ç›®ãƒªã‚¹ãƒˆæ›´æ–°
        async function refreshGrammarList() {
            const listContainer = document.getElementById('grammarList');
            
            try {
                if (!currentMetadata) {
                    currentMetadata = await generator.loadMetadata();
                }
                
                if (!currentMetadata) {
                    listContainer.innerHTML = '<p>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                    return;
                }
                
                let html = '';
                Object.entries(currentMetadata).forEach(([key, data]) => {
                    html += `
                        <div class="grammar-item" onclick="previewPage('${key}')">
                            <div>
                                <div class="grammar-name">${data.displayName}</div>
                                <div class="grammar-key">${data.grammarKey}</div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="event.stopPropagation(); loadToEditor('${key}')" class="btn-small" title="ç·¨é›†">âœï¸</button>
                                <button onclick="event.stopPropagation(); deleteGrammarItem('${key}')" class="btn-small btn-delete" title="å‰Šé™¤">ğŸ—‘ï¸</button>
                                <div onclick="event.stopPropagation();">ğŸ‘ï¸</div>
                            </div>
                        </div>
                    `;
                });
                
                listContainer.innerHTML = html;
                logMessage(`æ–‡æ³•é …ç›®ãƒªã‚¹ãƒˆæ›´æ–°å®Œäº†: ${Object.keys(currentMetadata).length} é …ç›®`, 'success');
                
            } catch (error) {
                listContainer.innerHTML = '<p>æ–‡æ³•é …ç›®ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>';
                logMessage(`æ–‡æ³•é …ç›®ãƒªã‚¹ãƒˆæ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        async function previewPage(grammarKey) {
            const previewFrame = document.getElementById('previewFrame');
            
            try {
                updateSystemStatus('working');
                logMessage(`ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆä¸­: ${grammarKey}`, 'info');
                
                const result = await tester.previewPage(grammarKey);
                
                if (result) {
                    previewFrame.src = result.url;
                    previewFrame.style.display = 'block';
                    
                    // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
                    selectedGrammarKey = grammarKey;
                    document.getElementById('selectedPageInfo').style.display = 'block';
                    document.getElementById('selectedPageName').textContent = result.displayName;
                    document.getElementById('generateSelectedBtn').disabled = false;
                    
                    logMessage(`âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆå®Œäº†: ${result.displayName}`, 'success');
                } else {
                    logMessage('âŒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
                
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // é¸æŠã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã®å€‹åˆ¥ç”Ÿæˆ
        async function generateSelectedPage() {
            if (!selectedGrammarKey) {
                logMessage('âŒ ç”Ÿæˆå¯¾è±¡ãƒšãƒ¼ã‚¸ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            updateSystemStatus('working');
            const pageData = currentMetadata[selectedGrammarKey];
            logMessage(`å€‹åˆ¥ãƒšãƒ¼ã‚¸ç”Ÿæˆé–‹å§‹: ${pageData.displayName}`, 'info');
            
            try {
                const template = await generator.loadTemplate();
                const html = generator.generatePage(template, pageData);
                
                // ç”Ÿæˆã•ã‚ŒãŸHTMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã«ã™ã‚‹
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${pageData.filename}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                logMessage(`âœ… ${pageData.displayName} ç”Ÿæˆå®Œäº†ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹`, 'success');
                logMessage(`ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å: ${pageData.filename}.html`, 'info');
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`å€‹åˆ¥ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‰ã˜ã‚‹
        function closePreview() {
            const previewFrame = document.getElementById('previewFrame');
            previewFrame.style.display = 'none';
            previewFrame.src = '';
            
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedGrammarKey = null;
            document.getElementById('selectedPageInfo').style.display = 'none';
            document.getElementById('generateSelectedBtn').disabled = true;
            
            logMessage('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‰ã˜ã¾ã—ãŸ', 'info');
        }

        // ã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½
        function insertMarkdown(before, after) {
            const textarea = document.getElementById('contentEditor');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            const newText = before + selectedText + after;
            
            textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + before.length, start + before.length + selectedText.length);
        }

        function insertExample() {
            const textarea = document.getElementById('contentEditor');
            const exampleText = '\n[[ä¾‹æ–‡: ã“ã“ã«ä¾‹æ–‡ã‚’å…¥åŠ›]]\n';
            const cursorPos = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, cursorPos) + exampleText + textarea.value.substring(cursorPos);
            textarea.focus();
            textarea.setSelectionRange(cursorPos + 7, cursorPos + exampleText.length - 3);
        }

        function insertKeyPoint() {
            const textarea = document.getElementById('contentEditor');
            const pointText = '\n[[é‡è¦: é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’å…¥åŠ›]]\n';
            const cursorPos = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, cursorPos) + pointText + textarea.value.substring(cursorPos);
            textarea.focus();
            textarea.setSelectionRange(cursorPos + 7, cursorPos + pointText.length - 3);
        }

        // è‡ªå‹•æ•´å½¢æ©Ÿèƒ½
        function autoFormatContent() {
            const textarea = document.getElementById('contentEditor');
            const rawContent = textarea.value.trim();
            
            if (!rawContent) {
                logMessage('âŒ æ•´å½¢ã™ã‚‹æœ¬æ–‡ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            logMessage('ğŸš€ è‡ªå‹•æ•´å½¢é–‹å§‹...', 'info');
            
            try {
                // ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆæ•´å½¢å‡¦ç†
                const formattedContent = ContentFormatter.autoFormat(rawContent);
                
                // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«åæ˜ 
                textarea.value = formattedContent;
                
                // è‡ªå‹•çš„ã«ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚‚å®Ÿè¡Œ
                livePreview();
                
                logMessage('âœ… è‡ªå‹•æ•´å½¢å®Œäº†ï¼ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã—ã¦ãã ã•ã„', 'success');
                
            } catch (error) {
                logMessage(`è‡ªå‹•æ•´å½¢ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆæ•´å½¢å‡¦ç†ã‚¯ãƒ©ã‚¹
        class ContentFormatter {
            static autoFormat(content) {
                let formatted = content;
                
                // 1. æ®µè½åˆ†é›¢ã¨ã‚¿ã‚¤ãƒˆãƒ«æ¤œå‡º
                const lines = formatted.split('\n').map(line => line.trim()).filter(line => line);
                const result = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const nextLine = lines[i + 1];
                    
                    // ãƒ¡ã‚¤ãƒ³è¦‹å‡ºã—æ¤œå‡ºï¼ˆçŸ­ã„è¡Œã§ã€æ¬¡ã«èª¬æ˜ãŒç¶šãï¼‰
                    if (this.isMainHeading(line, nextLine)) {
                        result.push(`## ${line}`);
                        result.push('');
                    }
                    // ã‚µãƒ–è¦‹å‡ºã—æ¤œå‡ºï¼ˆã€ŒåŸºæœ¬æ§‹é€ ã€ã€Œä¾‹æ–‡ã€ã€Œä½¿ã„æ–¹ã€ç­‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰
                    else if (this.isSubHeading(line)) {
                        result.push(`### ${line}`);
                        result.push('');
                    }
                    // ä¾‹æ–‡æ¤œå‡º
                    else if (this.isExampleSentence(line)) {
                        result.push(`[[ä¾‹æ–‡: ${line}]]`);
                        result.push('');
                    }
                    // é‡è¦ãƒã‚¤ãƒ³ãƒˆæ¤œå‡º
                    else if (this.isKeyPoint(line)) {
                        result.push(`[[é‡è¦: ${line}]]`);
                        result.push('');
                    }
                    // ãƒªã‚¹ãƒˆé …ç›®æ¤œå‡º
                    else if (this.isListItem(line)) {
                        result.push(`- ${line.replace(/^[-â€¢*]\s*/, '')}`);
                    }
                    // é€šå¸¸ã®æ®µè½
                    else {
                        result.push(line);
                        result.push('');
                    }
                }
                
                return result.join('\n').replace(/\n{3,}/g, '\n\n').trim();
            }
            
            static isMainHeading(line, nextLine) {
                // çŸ­ã„è¡Œã§ã€ç–‘å•ç³»ã‚„ã‚¿ã‚¤ãƒˆãƒ«ç³»ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
                const titlePatterns = [
                    /ã¨ã¯$/, /ã«ã¤ã„ã¦$/, /ã®ç‰¹å¾´$/, /ã®åŸºæœ¬$/, /ã®æ¦‚è¦$/,
                    /^ç¬¬\d+/, /^[\dä¸€äºŒä¸‰å››äº”]+\./, /^Chapter/, /^ç¬¬.*ç« /
                ];
                
                return line.length < 30 && 
                       nextLine && nextLine.length > line.length &&
                       titlePatterns.some(pattern => pattern.test(line));
            }
            
            static isSubHeading(line) {
                const subPatterns = [
                    /^åŸºæœ¬æ§‹é€ $/, /^æ§‹é€ $/, /^ä¾‹æ–‡$/, /^ä½¿ã„æ–¹$/, /^ç‰¹å¾´$/,
                    /^ãƒã‚¤ãƒ³ãƒˆ$/, /^æ³¨æ„ç‚¹$/, /^å¿œç”¨$/, /^ã¾ã¨ã‚$/,
                    /^ç¨®é¡$/, /^åˆ†é¡$/, /^å½¢å¼$/, /^ãƒ‘ã‚¿ãƒ¼ãƒ³$/
                ];
                
                return line.length < 20 && subPatterns.some(pattern => pattern.test(line));
            }
            
            static isExampleSentence(line) {
                // è‹±èªã‚’å«ã‚€æ–‡ã‚„ã€æ˜ã‚‰ã‹ãªä¾‹æ–‡ãƒ‘ã‚¿ãƒ¼ãƒ³
                const examplePatterns = [
                    /[A-Z][a-z]+.*\./,  // è‹±èªæ–‡
                    /\(.+?\)$/,         // æ—¥æœ¬èªè¨³ãŒæœ«å°¾ã«ã‚ã‚‹
                    /^I\s/, /^She\s/, /^He\s/, /^They\s/, /^We\s/,  // å…¸å‹çš„ãªä¾‹æ–‡é–‹å§‹
                ];
                
                return examplePatterns.some(pattern => pattern.test(line)) ||
                       (line.includes('(') && line.includes(')') && line.length < 100);
            }
            
            static isKeyPoint(line) {
                const keyPatterns = [
                    /^é‡è¦/, /^ãƒã‚¤ãƒ³ãƒˆ/, /^æ³¨æ„/, /^è¦šãˆã¦/, /^å¤§åˆ‡/,
                    /ã“ã¨ãŒé‡è¦/, /ã«æ³¨æ„/, /ãŒãƒã‚¤ãƒ³ãƒˆ/
                ];
                
                return keyPatterns.some(pattern => pattern.test(line));
            }
            
            static isListItem(line) {
                return /^[-â€¢*]\s/.test(line) || 
                       (line.length < 80 && /^[\dä¸€äºŒä¸‰å››äº”]+\./.test(line));
            }
        }

        // ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
        function livePreview() {
            const content = document.getElementById('contentEditor').value;
            const container = document.getElementById('livePreviewContainer');
            const previewContent = document.getElementById('livePreviewContent');
            
            if (!content.trim()) {
                logMessage('âŒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                // Markdownã‚’å‡¦ç†
                let processedContent = MarkdownProcessor.addSpecialBoxes(content);
                processedContent = MarkdownProcessor.process(processedContent);
                
                previewContent.innerHTML = processedContent;
                container.style.display = 'block';
                container.scrollIntoView({ behavior: 'smooth' });
                
                logMessage('âœ… ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°å®Œäº†', 'success');
                
            } catch (error) {
                logMessage(`ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚¨ãƒ‡ã‚£ã‚¿ã‹ã‚‰ãƒšãƒ¼ã‚¸ç”Ÿæˆ
        async function generateFromEditor() {
            const displayName = document.getElementById('grammarDisplayName').value.trim();
            const grammarKey = document.getElementById('grammarKey').value.trim();
            const filename = document.getElementById('grammarFilename').value.trim();
            const jsonFile = document.getElementById('grammarJsonFile').value.trim();
            const description = document.getElementById('grammarDescription').value.trim();
            const content = document.getElementById('contentEditor').value.trim();
            
            // å…¥åŠ›æ¤œè¨¼
            if (!displayName || !grammarKey || !filename || !jsonFile || !content) {
                logMessage('âŒ å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            updateSystemStatus('working');
            logMessage('ã‚¨ãƒ‡ã‚£ã‚¿ã‹ã‚‰ãƒšãƒ¼ã‚¸ç”Ÿæˆé–‹å§‹...', 'info');
            
            try {
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‡¦ç†
                let processedContent = MarkdownProcessor.addSpecialBoxes(content);
                processedContent = MarkdownProcessor.process(processedContent);
                
                // HTMLãƒšãƒ¼ã‚¸ç”Ÿæˆ
                const template = await generator.loadTemplate();
                if (!template) {
                    logMessage('âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    return;
                }
                
                const pageData = {
                    displayName: displayName,
                    grammarKey: grammarKey,
                    filename: filename,
                    description: description || `${displayName}ã®æ–‡æ³•è§£èª¬`,
                    content: processedContent
                };
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ç½®æ›
                let html = template
                    .replace(/\{\{displayName\}\}/g, pageData.displayName)
                    .replace(/\{\{description\}\}/g, pageData.description)
                    .replace(/\{\{grammarKey\}\}/g, pageData.grammarKey)
                    .replace(/\{\{content\}\}/g, 
                        `<section class="content-section">${pageData.content}</section>`);
                
                // HTMLãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const blob = new Blob([html], { type: 'text/html; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // ã‚¨ãƒ‡ã‚£ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”¨ï¼‰
                editorData = {
                    key: filename,
                    displayName: displayName,
                    grammarKey: grammarKey,
                    filename: filename,
                    jsonFile: jsonFile,
                    description: description,
                    rawContent: content,
                    processedContent: processedContent
                };
                
                logMessage(`âœ… ${displayName} ç”Ÿæˆå®Œäº†ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹`, 'success');
                logMessage(`ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å: ${filename}.html`, 'info');
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜
        async function saveToMetadata() {
            if (!editorData) {
                logMessage('âŒ ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ãƒšãƒ¼ã‚¸ç”Ÿæˆã‚’è¡Œã£ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                const metadata = await generator.loadMetadata() || {};
                
                // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«å¤‰æ›
                metadata[editorData.key] = {
                    displayName: editorData.displayName,
                    grammarKey: editorData.grammarKey,
                    filename: editorData.filename,
                    jsonFile: editorData.jsonFile,
                    description: editorData.description,
                    category: "grammar-basics",
                    priority: Object.keys(metadata).length + 1,
                    matrixDisplay: editorData.displayName,
                    content: {
                        sections: [{
                            title: editorData.displayName,
                            content: [{
                                type: "custom-html",
                                html: editorData.processedContent
                            }]
                        }]
                    }
                };
                
                // preset_config.jsonã‚‚è‡ªå‹•æ›´æ–°
                await updatePresetConfig(editorData);
                
                // JSONå‡ºåŠ›ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
                const blob = new Blob([JSON.stringify(metadata, null, 2)], { 
                    type: 'application/json; charset=utf-8' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'grammar-metadata.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                logMessage(`âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜å®Œäº†: ${editorData.displayName}`, 'success');
                logMessage('ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å: grammar-metadata.json', 'info');
                
                // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±æ›´æ–°
                currentMetadata = metadata;
                await loadSystemInfo();
                
            } catch (error) {
                logMessage(`ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // preset_config.jsonè‡ªå‹•æ›´æ–°æ©Ÿèƒ½
        async function updatePresetConfig(editorData) {
            try {
                logMessage('ğŸ”§ preset_config.jsonè‡ªå‹•æ›´æ–°é–‹å§‹...', 'info');
                
                // ç¾åœ¨ã®preset_config.jsonã‚’èª­ã¿è¾¼ã¿
                const response = await fetch('../data/preset_config.json');
                let presetConfig;
                
                if (response.ok) {
                    presetConfig = await response.json();
                    logMessage('âœ… ç¾åœ¨ã®preset_config.jsonèª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                } else {
                    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆ
                    presetConfig = {
                        presets: [],
                        instructions: {
                            title: "ğŸ”§ æ–°è¦ä¾‹æ–‡ã‚»ãƒƒãƒˆJSONã®è¿½åŠ æ–¹æ³•",
                            steps: [
                                "1. æ–°ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ data/ ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®",
                                "2. ä¸Šè¨˜ã® presets é…åˆ—ã«æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ :",
                                "3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿"
                            ],
                            note: "ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šã€HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ãªãæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’è¿½åŠ ã§ãã¾ã™ã€‚"
                        }
                    };
                    logMessage('ğŸ’¡ preset_config.jsonã‚’æ–°è¦ä½œæˆã—ã¾ã™', 'info');
                }
                
                // æ–°ã—ã„ãƒ—ãƒªã‚»ãƒƒãƒˆé …ç›®ã‚’ç”Ÿæˆ
                const jsonFileName = editorData.jsonFile.endsWith('.json') ? editorData.jsonFile : editorData.jsonFile + '.json';
                const newPreset = {
                    id: `dataset_${Date.now()}`, // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDç”Ÿæˆ
                    name: editorData.displayName,
                    file: `data/${jsonFileName}`,
                    description: editorData.description || `${editorData.displayName}ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ`
                };
                
                // æ—¢å­˜é …ç›®ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
                const existingPreset = presetConfig.presets.find(preset => 
                    preset.name === newPreset.name || preset.file === newPreset.file
                );
                
                if (existingPreset) {
                    logMessage(`âš ï¸ æ—¢å­˜é …ç›®ç™ºè¦‹: ${existingPreset.name} - ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™`, 'info');
                } else {
                    // æ–°ã—ã„ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è¿½åŠ 
                    presetConfig.presets.push(newPreset);
                    logMessage(`âœ… æ–°ã—ã„ãƒ—ãƒªã‚»ãƒƒãƒˆè¿½åŠ : ${newPreset.name}`, 'success');
                    
                    // æ›´æ–°ã•ã‚ŒãŸpreset_config.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const presetBlob = new Blob([JSON.stringify(presetConfig, null, 2)], { 
                        type: 'application/json; charset=utf-8' 
                    });
                    const presetUrl = URL.createObjectURL(presetBlob);
                    const presetLink = document.createElement('a');
                    presetLink.href = presetUrl;
                    presetLink.download = 'preset_config.json';
                    document.body.appendChild(presetLink);
                    presetLink.click();
                    document.body.removeChild(presetLink);
                    URL.revokeObjectURL(presetUrl);
                    
                    logMessage('ğŸ“ æ›´æ–°ã•ã‚ŒãŸpreset_config.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
                    logMessage('ğŸ’¡ data/ãƒ•ã‚©ãƒ«ãƒ€ã«æ–°ã—ã„preset_config.jsonã‚’ä¿å­˜ã—ã¦ãã ã•ã„', 'info');
                }
                
            } catch (error) {
                logMessage(`preset_config.jsonæ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚¨ãƒ‡ã‚£ã‚¿ã‚¯ãƒªã‚¢
        function clearEditor() {
            if (confirm('ã‚¨ãƒ‡ã‚£ã‚¿ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                document.getElementById('grammarDisplayName').value = '';
                document.getElementById('grammarKey').value = '';
                document.getElementById('grammarFilename').value = '';
                document.getElementById('grammarJsonFile').value = '';
                document.getElementById('grammarDescription').value = '';
                document.getElementById('contentEditor').value = '';
                document.getElementById('livePreviewContainer').style.display = 'none';
                
                editorData = null;
                logMessage('ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
            }
        }

        // æ–‡æ³•é …ç›®å‰Šé™¤æ©Ÿèƒ½
        async function deleteGrammarItem(grammarKey) {
            if (!currentMetadata || !currentMetadata[grammarKey]) {
                logMessage('âŒ å‰Šé™¤å¯¾è±¡ã®é …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            const pageData = currentMetadata[grammarKey];
            const confirmMessage = `ã€Œ${pageData.displayName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚\nå‰Šé™¤å¾Œã€æ–°ã—ã„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                updateSystemStatus('working');
                logMessage(`æ–‡æ³•é …ç›®å‰Šé™¤é–‹å§‹: ${pageData.displayName}`, 'info');
                
                // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤
                const updatedMetadata = { ...currentMetadata };
                delete updatedMetadata[grammarKey];
                
                // priorityã‚’å†æ¡ç•ª
                let priority = 1;
                Object.values(updatedMetadata).forEach(item => {
                    item.priority = priority++;
                });
                
                // JSONå‡ºåŠ›ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
                const blob = new Blob([JSON.stringify(updatedMetadata, null, 2)], { 
                    type: 'application/json; charset=utf-8' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'grammar-metadata.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±æ›´æ–°
                currentMetadata = updatedMetadata;
                await loadSystemInfo();
                await refreshGrammarList();
                
                logMessage(`âœ… ${pageData.displayName} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'success');
                logMessage('ğŸ“ æ›´æ–°ã•ã‚ŒãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'info');
                logMessage('ğŸ’¡ æ–°ã—ã„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ãã ã•ã„', 'info');
                
                updateSystemStatus('ready');
                
            } catch (error) {
                logMessage(`å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateSystemStatus('error');
            }
        }

        // æ—¢å­˜é …ç›®ã‚’ç·¨é›†ã‚¨ãƒªã‚¢ã«ãƒ­ãƒ¼ãƒ‰
        async function loadToEditor(grammarKey) {
            try {
                if (!currentMetadata || !currentMetadata[grammarKey]) {
                    logMessage('âŒ é …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    return;
                }
                
                const data = currentMetadata[grammarKey];
                
                // åŸºæœ¬æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®š
                document.getElementById('grammarDisplayName').value = data.displayName || '';
                document.getElementById('grammarKey').value = data.grammarKey || '';
                document.getElementById('grammarFilename').value = data.filename || '';
                document.getElementById('grammarJsonFile').value = data.jsonFile || '';
                document.getElementById('grammarDescription').value = data.description || '';
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®æº–å‚™ï¼‰
                document.getElementById('contentEditor').value = 'ç·¨é›†ç”¨ã®Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...';
                
                logMessage(`âœ… ${data.displayName} ã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`, 'success');
                logMessage('ğŸ’¡ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã«æ–°ã—ã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ç·¨é›†ã§ãã¾ã™', 'info');
                
                // ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒªã‚¢ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                const editorSection = document.querySelector('.control-section h2');
                if (editorSection && editorSection.textContent.includes('âœï¸')) {
                    editorSection.scrollIntoView({ behavior: 'smooth' });
                }
                
            } catch (error) {
                logMessage(`ç·¨é›†ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            logMessage('ç®¡ç†ãƒ‘ãƒãƒ«èµ·å‹•ä¸­...', 'info');
            initializeSystem();
        });
    </script>
</body>
</html>
